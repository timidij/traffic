<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Light Control System</title>
    <style>
        /* General body styling */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1, h2 {
            color: #0056b3;
            text-align: center;
        }

        p {
            text-align: center;
        }

        /* Form and Upload Area */
        #main-form-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 20px auto;
            text-align: center;
            width: 100%;
        }

        .individual-upload-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns */
            gap: 20px;
            margin-top: 20px;
        }

        .upload-quadrant {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s ease, background-color 0.3s ease;
            border-radius: 8px;
            position: relative;
            min-height: 200px; /* Ensure consistent height */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-quadrant.highlight {
            border-color: #007bff;
            background-color: #e6f7ff;
        }

        .upload-quadrant input[type="file"] {
            display: none; /* Hide the actual file input */
        }

        .upload-quadrant h3 {
            margin-top: 0;
            color: #007bff;
        }

        .quadrant-image-preview {
            max-width: 100%;
            max-height: 120px; /* Limit height of preview image */
            object-fit: contain;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #ddd;
            display: none; /* Hidden until loaded */
        }

        .quadrant-image-preview:not([src=""]) {
            display: block; /* Show if src is set */
        }

        .error-message-individual {
            color: #dc3545;
            font-size: 0.85em;
            margin-top: 5px;
            display: none;
        }

        #overall-error-message {
            color: #dc3545;
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }

        #predict-btn {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 25px;
            transition: background-color 0.3s ease;
        }

        #predict-btn:hover:not(:disabled) {
            background-color: #0056b3;
        }

        #predict-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Results Container */
        .results-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 30px auto;
            text-align: center;
            width: 100%;
        }

        /* Intersection Grid Layout (Roads) */
        .intersection-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr; /* Wider middle column for vertical roads */
            grid-template-rows: 1fr 1.5fr 1fr; /* Taller middle row for horizontal roads */
            gap: 0; /* Remove gap */
            background-color: #555; /* Road color for the entire intersection area */
            border-radius: 15px;
            overflow: hidden; /* Hide anything outside bounds */
            position: relative; /* For absolute positioning of lights */
            max-width: 800px; /* Control overall size */
            margin: 30px auto;
        }

        /* The actual intersection center */
        .intersection-grid::before {
            content: '';
            grid-column: 2 / 3;
            grid-row: 2 / 3;
            background-color: #333; /* Darker for the intersection itself */
            border: 2px dashed #eee; /* Road markings */
            border-radius: 5px;
            z-index: 1; /* Ensure it's behind the light elements if they overlap slightly */
            margin: 5px; /* Creates a smaller central square */
        }

        /* Individual Quadrants (Road segments) */
        .intersection-quadrant {
            background-color: #666; /* Slightly lighter road color for segments */
            color: white;
            border: none;
            box-shadow: none;
            border-radius: 0;
            display: flex;
            flex-direction: column; /* Default for vertical roads */
            align-items: center;
            text-align: center;
            padding: 10px;
            position: relative; /* For text and image placement */
            justify-content: flex-start; /* Default alignment for content */
        }

        /* Positioning of Quadrants on the Grid */
        #north-approach {
            grid-area: 1 / 2 / 2 / 3;
            border-bottom: 2px dashed #eee;
            justify-content: flex-end; /* Push content to bottom of north road */
        }
        #south-approach {
            grid-area: 3 / 2 / 4 / 3;
            border-top: 2px dashed #eee;
            justify-content: flex-start; /* Push content to top of south road */
        }
        #east-approach {
            grid-area: 2 / 3 / 3 / 4;
            border-left: 2px dashed #eee;
            flex-direction: row; /* Horizontal road */
            justify-content: flex-start; /* Push content to left of east road */
        }
        #west-approach {
            grid-area: 2 / 1 / 3 / 2;
            border-right: 2px dashed #eee;
            flex-direction: row-reverse; /* Horizontal road, content from right */
            justify-content: flex-end; /* Push content to right of west road */
        }

        /* Content within Quadrants */
        .intersection-quadrant h3 {
            margin: 5px 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-size: 1.1em;
        }
        .intersection-quadrant p {
            font-size: 0.85em;
            margin: 2px 0;
            color: #eee;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .quadrant-image {
            max-width: 90%;
            max-height: 90px; /* Smaller images within the road segment */
            object-fit: contain;
            border-radius: 3px;
            margin-top: 5px;
            border: 1px solid #ddd;
            display: none; /* Hidden until loaded */
        }
        .quadrant-image:not([src=""]) {
            display: block; /* Show if image present */
        }

        /* Traffic Light Styling */
        .traffic-light {
            position: absolute; /* Position relative to the .intersection-grid container */
            width: 25px;
            height: 70px;
            background-color: #222;
            border-radius: 8px;
            padding: 4px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            z-index: 10; /* Ensure lights are on top */
        }

        .traffic-light .light {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #555; /* Default off state */
            border: 1px solid #333;
        }

        /* Light colors (active state) */
        .traffic-light .light.red.active {
            background-color: #dc3545; /* Red */
            box-shadow: 0 0 8px #dc3545;
        }
        .traffic-light .light.yellow.active {
            background-color: #ffc107; /* Yellow */
            box-shadow: 0 0 8px #ffc107;
        }
        .traffic-light .light.green.active {
            background-color: #28a745; /* Green */
            box-shadow: 0 0 8px #28a745;
        }

        /* Specific Traffic Light Positions (Fine-tune these as needed) */
        /* These place the lights at the edge of the intersection, on the road */
        .traffic-light.north { top: 75%; left: 42%; transform: translateX(-50%) rotate(180deg); } /* Bottom of North road */
        .traffic-light.south { bottom: 75%; left: 58%; transform: translateX(-50%) rotate(0deg); } /* Top of South road */
        .traffic-light.east { top: 42%; left: 25%; transform: translateY(-50%) rotate(90deg); } /* Left of East road */
        .traffic-light.west { top: 58%; right: 25%; transform: translateY(-50%) rotate(-90deg); } /* Right of West road */


        /* Media Query for Responsiveness */
        @media (max-width: 768px) {
            .individual-upload-grid {
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }
            .upload-quadrant {
                min-height: auto;
                padding: 15px;
            }

            .intersection-grid {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, auto);
                max-width: 400px;
                border-radius: 10px;
                padding: 10px; /* Add some padding to the road area itself */
            }

            .intersection-grid::before {
                display: none; /* Hide intersection center on small screens */
            }

            .intersection-quadrant {
                flex-direction: column; /* Stack content vertically */
                border: 1px solid #eee;
                margin-bottom: 10px;
                text-align: center;
                justify-content: center;
                padding: 15px;
            }
            #north-approach, #south-approach, #east-approach, #west-approach {
                grid-area: auto; /* Reset grid areas */
                border: none; /* Remove road borders */
                border-bottom: 1px dashed #ccc; /* Add separator */
            }
            #west-approach { border-bottom: none; } /* Last one has no border */

            .traffic-light {
                position: static; /* Remove absolute positioning */
                transform: none; /* Remove rotations */
                margin: 10px auto; /* Center lights */
                width: 30px; /* Restore size */
                height: 80px;
            }
            .quadrant-image {
                max-height: 100px; /* Adjust image size for mobile */
            }
        }
    </style>
</head>
<body>
    <div id="main-form-container">
        <h1>Traffic Light Control System</h1>
        <p>Upload an image for each of the four intersection approaches (North, South, East, West).</p>
        
        <div class="individual-upload-grid">
            <div class="upload-quadrant" id="drop-area-north">
                <h3>North Approach</h3>
                <p>Drag & drop or click</p>
                <input type="file" id="file-input-north" accept="image/*" name="image_north">
                <img class="quadrant-image-preview" id="preview-north" alt="North Image Preview">
                <div class="error-message-individual" id="error-north"></div>
            </div>

            <div class="upload-quadrant" id="drop-area-south">
                <h3>South Approach</h3>
                <p>Drag & drop or click</p>
                <input type="file" id="file-input-south" accept="image/*" name="image_south">
                <img class="quadrant-image-preview" id="preview-south" alt="South Image Preview">
                <div class="error-message-individual" id="error-south"></div>
            </div>

            <div class="upload-quadrant" id="drop-area-east">
                <h3>East Approach</h3>
                <p>Drag & drop or click</p>
                <input type="file" id="file-input-east" accept="image/*" name="image_east">
                <img class="quadrant-image-preview" id="preview-east" alt="East Image Preview">
                <div class="error-message-individual" id="error-east"></div>
            </div>

            <div class="upload-quadrant" id="drop-area-west">
                <h3>West Approach</h3>
                <p>Drag & drop or click</p>
                <input type="file" id="file-input-west" accept="image/*" name="image_west">
                <img class="quadrant-image-preview" id="preview-west" alt="West Image Preview">
                <div class="error-message-individual" id="error-west"></div>
            </div>
        </div>
        
        <div class="error" id="overall-error-message"></div>
        <button type="button" id="predict-btn" disabled>Simulate Traffic</button>
        <button type="button" id="stop-simulation-btn" style="display: none; background-color: #dc3545; margin-left: 10px;">Stop Simulation</button>
    </div>
    
    <div class="results-container" id="results-container" style="display: none;">
        <h2>Intersection Status</h2>
        <p id="overall-status-message"></p>

        <div class="intersection-grid">
            <div class="intersection-quadrant" id="north-approach">
                <h3>North</h3>
                <img class="quadrant-image" id="img-north" alt="North Traffic">
                <p>Status: <span id="status-north"></span></p>
                <p>Conf: <span id="confidence-north"></span></p>
            </div>

            <div class="traffic-light north" id="light-north">
                <div class="light red"></div>
                <div class="light yellow"></div>
                <div class="light green"></div>
            </div>

            <div class="intersection-quadrant" id="west-approach">
                <h3>West</h3>
                <img class="quadrant-image" id="img-west" alt="West Traffic">
                <p>Status: <span id="status-west"></span></p>
                <p>Conf: <span id="confidence-west"></span></p>
            </div>

            <div class="traffic-light west" id="light-west">
                <div class="light red"></div>
                <div class="light yellow"></div>
                <div class="light green"></div>
            </div>

            <div class="intersection-quadrant" id="east-approach">
                <h3>East</h3>
                <img class="quadrant-image" id="img-east" alt="East Traffic">
                <p>Status: <span id="status-east"></span></p>
                <p>Conf: <span id="confidence-east"></span></p>
            </div>

            <div class="traffic-light east" id="light-east">
                <div class="light red"></div>
                <div class="light yellow"></div>
                <div class="light green"></div>
            </div>

            <div class="intersection-quadrant" id="south-approach">
                <h3>South</h3>
                <img class="quadrant-image" id="img-south" alt="South Traffic">
                <p>Status: <span id="status-south"></span></p>
                <p>Conf: <span id="confidence-south"></span></p>
            </div>

            <div class="traffic-light south" id="light-south">
                <div class="light red"></div>
                <div class="light yellow"></div>
                <div class="light green"></div>
            </div>
        </div>
    </div>

    <script>
        // Store selected files by their direction
        const selectedFiles = {
            north: null,
            south: null,
            east: null,
            west: null
        };

        // DOM elements for each approach's input/preview/error
        const approachElements = {
            north: {
                dropArea: document.getElementById('drop-area-north'),
                fileInput: document.getElementById('file-input-north'),
                preview: document.getElementById('preview-north'),
                errorDisplay: document.getElementById('error-north')
            },
            south: {
                dropArea: document.getElementById('drop-area-south'),
                fileInput: document.getElementById('file-input-south'),
                preview: document.getElementById('preview-south'),
                errorDisplay: document.getElementById('error-south')
            },
            east: {
                dropArea: document.getElementById('drop-area-east'),
                fileInput: document.getElementById('file-input-east'),
                preview: document.getElementById('preview-east'),
                errorDisplay: document.getElementById('error-east')
            },
            west: {
                dropArea: document.getElementById('drop-area-west'),
                fileInput: document.getElementById('file-input-west'),
                preview: document.getElementById('preview-west'),
                errorDisplay: document.getElementById('error-west')
            }
        };

        const overallErrorMessage = document.getElementById('overall-error-message');
        const predictBtn = document.getElementById('predict-btn');
        const stopSimulationBtn = document.getElementById('stop-simulation-btn');
        const resultsContainer = document.getElementById('results-container');
        const overallStatusMessage = document.getElementById('overall-status-message');

        const DIRECTIONS = ['north', 'south', 'east', 'west'];

        // --- Traffic Light Simulation Variables ---
        // This will be updated with data from the backend after prediction
        let currentTrafficDemand = { north: false, south: false, east: false, west: false };
        let currentPhase = 'ALL_RED'; // Start always from ALL_RED
        let phaseTimer = null; // Stores the setInterval ID
        let phaseStartTime = 0; // Timestamp when current phase began
        let lastGreenPhase = null; // To help alternate if both N-S and E-W have demand

        // Configuration for light timing (in milliseconds)
        const MIN_GREEN_TIME = 8000; // Minimum time a light stays green (8 seconds)
        // Removed YELLOW_LIGHT_TIME and ALL_RED_TIME as we're simplifying direct transitions

        const CYCLE_INTERVAL = 1000; // How often to check/update (1 second)

        // --- Utility Functions ---

        function showOverallError(message) {
            overallErrorMessage.textContent = message;
            overallErrorMessage.style.display = 'block';
        }

        function hideOverallError() {
            overallErrorMessage.style.display = 'none';
        }

        function showIndividualError(direction, message) {
            approachElements[direction].errorDisplay.textContent = message;
            approachElements[direction].errorDisplay.style.display = 'block';
        }

        function hideIndividualError(direction) {
            approachElements[direction].errorDisplay.style.display = 'none';
        }

        // Resets the UI elements for results and lights
        function resetTrafficLightsAndResults() {
            DIRECTIONS.forEach(direction => {
                const lightElement = document.getElementById(`light-${direction}`);
                if (lightElement) {
                    lightElement.querySelectorAll('.light').forEach(light => light.classList.remove('active'));
                    lightElement.querySelector('.red').classList.add('active'); // Default to red
                }
                document.getElementById(`img-${direction}`).src = '';
                document.getElementById(`img-${direction}`).style.display = 'none'; // Hide image until loaded
                document.getElementById(`status-${direction}`).textContent = 'Waiting...';
                document.getElementById(`confidence-${direction}`).textContent = '';
            });
            overallStatusMessage.textContent = '';
            resultsContainer.style.display = 'none';
            stopTrafficSimulation(); // Ensure timer is stopped
        }

        function checkAllFilesSelected() {
            const allFilesPresent = DIRECTIONS.every(dir => selectedFiles[dir] !== null);
            predictBtn.disabled = !allFilesPresent;
            if (allFilesPresent) {
                hideOverallError();
            } else {
                showOverallError('Please select an image for all four approaches to start simulation.');
            }
        }
// --- Traffic Light Control Logic (Frontend State Machine) ---

function setLightColors(north, south, east, west, message) {
    // Remove active classes from all lights first
    DIRECTIONS.forEach(dir => {
        const lightElement = document.getElementById(`light-${dir}`);
        lightElement.querySelectorAll('.light').forEach(light => light.classList.remove('active'));
    });

    // Set specified light colors
    const lightStates = {
        north: north,
        south: south,
        east: east,
        west: west
    };

    for (const dir in lightStates) {
        const color = lightStates[dir];
        if (color) { // Only attempt to set if a color is provided
            document.getElementById(`light-${dir}`).querySelector(`.${color}`).classList.add('active');
        }
    }
    overallStatusMessage.textContent = message;
}

function determineNextPhase() {
    const timeElapsed = Date.now() - phaseStartTime;
    let nextPhase = currentPhase;
    let statusMessage = "Evaluating...";
// 
    // Determine demand for each direction
    const nDemand = currentTrafficDemand.north;
    const sDemand = currentTrafficDemand.south;
    const eDemand = currentTrafficDemand.east;
    const wDemand = currentTrafficDemand.west;

    // Create an array of lanes with traffic
    const lanesWithTraffic = [];
    if (nDemand) lanesWithTraffic.push('N_GREEN');
    if (sDemand) lanesWithTraffic.push('S_GREEN');
    if (eDemand) lanesWithTraffic.push('E_GREEN');
    if (wDemand) lanesWithTraffic.push('W_GREEN');

    // Determine the next phase based on traffic demand
    if (lanesWithTraffic.length > 0) {
        // If there are lanes with traffic, rotate through them
        if (currentPhase === 'ALL_RED' || timeElapsed >= MIN_GREEN_TIME) {
            // If it's time to switch or if we are starting from ALL_RED
            const currentIndex = lanesWithTraffic.indexOf(currentPhase);
            const nextIndex = (currentIndex + 1) % lanesWithTraffic.length;
            nextPhase = lanesWithTraffic[nextIndex];
            statusMessage = `${nextPhase.replace('_GREEN', ' Green')}`;
        }
    } else {
        // No traffic detected, stay ALL_RED
        nextPhase = 'ALL_RED';
        statusMessage = 'All Red (No traffic detected anywhere).';
    }

    // Update current phase if it changed
    if (nextPhase !== currentPhase) {
        console.log(`Phase change: ${currentPhase} -> ${nextPhase}`);
        currentPhase = nextPhase;
        phaseStartTime = Date.now(); // Reset timer for the new phase
    }

    // Apply light colors based on the CURRENT phase
    if (currentPhase === 'N_GREEN') {
        setLightColors('red', 'green', 'red', 'red', 'North Green');
    } else if (currentPhase === 'S_GREEN') {
        setLightColors('green', 'red', 'red', 'red', 'South Green');
    } else if (currentPhase === 'E_GREEN') {
        setLightColors('red', 'red', 'red', 'green', 'East Green');
    } else if (currentPhase === 'W_GREEN') {
        setLightColors('red', 'red', 'green', 'red', 'West Green');
    } else {
        setLightColors('red', 'red', 'red', 'red', 'All Red');
    }
}




// Main simulation loop
function startTrafficSimulation() {
    if (phaseTimer) clearInterval(phaseTimer); // Clear any existing timer

    currentPhase = 'ALL_RED'; // Always start simulation from ALL_RED for a clean cycle
    phaseStartTime = Date.now(); // Initialize timer for the ALL_RED phase

    // Set initial lights to all red immediately for the transition
    setLightColors('red', 'red', 'red', 'red', 'Starting simulation...');
    resultsContainer.style.display = 'block';
    stopSimulationBtn.style.display = 'inline-block';
    predictBtn.style.display = 'none'; // Hide simulate button when running

    phaseTimer = setInterval(determineNextPhase, CYCLE_INTERVAL);
}

   

        function stopTrafficSimulation() {
            if (phaseTimer) {
                clearInterval(phaseTimer);
                phaseTimer = null;
            }
            overallStatusMessage.textContent = 'Simulation Stopped.';
            setLightColors('red', 'red', 'red', 'red', 'Simulation Stopped.'); // Ensure lights are all red
            stopSimulationBtn.style.display = 'none';
            predictBtn.style.display = 'inline-block'; // Show simulate button again
        }

        // --- File Handling for Each Quadrant (No changes here from previous version) ---

        function handleFile(file, direction) {
            hideIndividualError(direction);
            const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                showIndividualError(direction, 'Invalid image type (JPEG, PNG, GIF).');
                selectedFiles[direction] = null;
                approachElements[direction].preview.src = '';
                approachElements[direction].preview.style.display = 'none';
                checkAllFilesSelected();
                return;
            }
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                showIndividualError(direction, 'Image too large (max 5MB).');
                selectedFiles[direction] = null;
                approachElements[direction].preview.src = '';
                approachElements[direction].preview.style.display = 'none';
                checkAllFilesSelected();
                return;
            }
            selectedFiles[direction] = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                approachElements[direction].preview.src = e.target.result;
                approachElements[direction].preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
            checkAllFilesSelected();
        }

        DIRECTIONS.forEach(direction => {
            const elements = approachElements[direction];
            elements.dropArea.addEventListener('click', () => { elements.fileInput.click(); });
            elements.fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) { handleFile(this.files[0], direction); }
                else {
                    selectedFiles[direction] = null;
                    elements.preview.src = '';
                    elements.preview.style.display = 'none';
                    hideIndividualError(direction);
                    checkAllFilesSelected();
                }
            });
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                elements.dropArea.addEventListener(eventName, preventDefaults, false);
            });
            elements.dropArea.addEventListener('dragenter', () => elements.dropArea.classList.add('highlight'), false);
            elements.dropArea.addEventListener('dragover', () => elements.dropArea.classList.add('highlight'), false);
            elements.dropArea.addEventListener('dragleave', () => elements.dropArea.classList.remove('highlight'), false);
            elements.dropArea.addEventListener('drop', (e) => {
                elements.dropArea.classList.remove('highlight');
                const dt = e.dataTransfer;
                if (dt.files && dt.files[0]) { handleFile(dt.files[0], direction); }
            }, false);
        });

        // Initial setup on load
        resetTrafficLightsAndResults();
        checkAllFilesSelected();

        // --- Prediction and Simulation Start ---
        predictBtn.addEventListener('click', async () => {
            if (!predictBtn.disabled) {
                predictBtn.disabled = true;
                predictBtn.textContent = 'Analyzing Traffic...';
                hideOverallError();

                try {
                    const formData = new FormData();
                    formData.append('images', selectedFiles.north, `north_${selectedFiles.north.name}`);
                    formData.append('images', selectedFiles.south, `south_${selectedFiles.south.name}`);
                    formData.append('images', selectedFiles.east, `east_${selectedFiles.east.name}`);
                    formData.append('images', selectedFiles.west, `west_${selectedFiles.west.name}`);

                    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

                    const response = await fetch('{% url "predict" %}', { // Make sure this URL is correct for your Django setup
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Server error during prediction');
                    }

                    const data = await response.json();
                    // console.log("Prediction Response:", data); // Log the full response
                    console.log("Prediction Response:", data.individual_predictions.east); // Log the full response

                    // Store the new traffic demand and individual prediction results
                    currentTrafficDemand = data.traffic_demand;
                    let trafficCondition = []
                    // Display individual predictions on the intersection quadrants
                    DIRECTIONS.forEach(direction => {
                        const prediction = data.individual_predictions[direction];
                        const imgDisplayElement = document.getElementById(`img-${direction}`);
                        const statusElement = document.getElementById(`status-${direction}`);
                        const confidenceElement = document.getElementById(`confidence-${direction}`);
                        console.log(`${direction},  ${prediction.class}`)
                        
                        if (prediction.class === "Traffic"){
                            trafficCondition.push(1)
                        }else{
                            trafficCondition.push(0)
                        }
                        
                        // trafficCondition.push(value)
                        

                        if (prediction) {
                            statusElement.textContent = prediction.class;
                            confidenceElement.textContent = `${(prediction.confidence * 100).toFixed(2)}%`;
                            imgDisplayElement.src = prediction.image;
                            imgDisplayElement.style.display = 'block';
                        } else {
                            statusElement.textContent = 'Error';
                            confidenceElement.textContent = 'N/A';
                            imgDisplayElement.src = '';
                            imgDisplayElement.style.display = 'none';
                        }
                    });

                    // Start the simulation loop
                    startTrafficSimulation();

                    console.log(trafficCondition)
                    trafficCondition.forEach((light)=>{
                            setLightColors("green","green","green","green")
                    })

                } catch (error) {
                    showOverallError(error.message);
                    resetTrafficLightsAndResults();
                    predictBtn.style.display = 'inline-block';
                    stopSimulationBtn.style.display = 'none';
                } finally {
                    predictBtn.disabled = false;
                    predictBtn.textContent = 'Simulate Traffic';
                }
            }
        });

        stopSimulationBtn.addEventListener('click', stopTrafficSimulation);

        // Prevents default drag behaviors
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
    </script>
</body>
</html>